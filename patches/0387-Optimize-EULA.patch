From 5da85be14d69d39bd2e0da738c47b761399c4437 Mon Sep 17 00:00:00 2001
From: YukiLeafX <yukileafx@gmail.com>
Date: Fri, 15 May 2020 19:39:35 +0900
Subject: [PATCH] Optimize EULA


diff --git a/src/main/java/net/minecraft/server/DedicatedServer.java b/src/main/java/net/minecraft/server/DedicatedServer.java
index 6a8292ce..2d7308e5 100644
--- a/src/main/java/net/minecraft/server/DedicatedServer.java
+++ b/src/main/java/net/minecraft/server/DedicatedServer.java
@@ -142,7 +142,7 @@ public class DedicatedServer extends MinecraftServer implements IMinecraftServer
         this.propertyManager = new PropertyManager(this.options); // CraftBukkit - CLI argument support
         this.r = new EULA(new File("eula.txt"));
         // Spigot Start
-        boolean eulaAgreed = Boolean.getBoolean( "com.mojang.eula.agree" );
+        boolean eulaAgreed = Boolean.getBoolean( "com.mojang.eula.agree" ) || Boolean.getBoolean("eula"); // Yukkit - short eula flag
         if ( eulaAgreed )
         {
             System.err.println( "You have used the Spigot command line EULA agreement flag." );
diff --git a/src/main/java/net/minecraft/server/EULA.java b/src/main/java/net/minecraft/server/EULA.java
index 3623751b..d4441004 100644
--- a/src/main/java/net/minecraft/server/EULA.java
+++ b/src/main/java/net/minecraft/server/EULA.java
@@ -8,6 +8,9 @@ import org.apache.commons.io.IOUtils;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 
+import java.util.logging.Level; // Yukkit
+import org.bukkit.ChatColor; // Yukkit
+
 public class EULA {
 
     private static final Logger a = LogManager.getLogger();
@@ -31,7 +34,8 @@ public class EULA {
             flag = Boolean.parseBoolean(properties.getProperty("eula", "false"));
         } catch (Exception exception) {
             EULA.a.warn("Failed to load {}", file);
-            this.b();
+            java.util.logging.Logger.getLogger("Minecraft").log(Level.INFO, ChatColor.AQUA + "Yukkit" + ChatColor.RESET + " >> Ignoring SAVE for " + ChatColor.YELLOW + "eula.txt" + ChatColor.RESET + "."); // Yukkit - log
+            return false; // Yukkit - don't save eula.txt when loading fails
         } finally {
             IOUtils.closeQuietly(fileinputstream);
         }
-- 
2.26.2.windows.1

