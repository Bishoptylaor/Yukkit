#!/usr/bin/env python

import os
import fire
import git
import json

def init(clean=False, file='modules.json'):
    if clean:
        for submod in repo.submodules:
            print('Cleaning', '>>', submod)
            submod.remove(force=True)

    with open(file, 'r') as f:
        j = f.read()
        for m in json.loads(j):
            print('Initializing', '>>', m['name'])
            submod = repo.create_submodule(m['name'], m['path'], url=m['url'])
            submod.update()
            submod.module().git.switch('--detach', m['commit'])
            print(chr(int(0x2705)), 'HEAD is now', m['commit'], '@', m['name'])

def install():
    init()
    print('//', 'TODO')

if __name__ == '__main__':
    repo = git.Repo(os.getcwd())
    fire.Fire()
    print('Done!')
